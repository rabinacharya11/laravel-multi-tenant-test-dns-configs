{
    # Global options
    on_demand_tls {
        # Caddy asks this endpoint if it's okay to issue a cert for a domain
        # We use a local listener on port 8080 to serve this via PHP-FPM
        ask http://127.0.0.1:8080/caddy-check
        
        # Rate limiting for certificate issuance
        interval 2m
        burst 5
    }
}

# Internal listener for the 'ask' endpoint
:8080 {
    # UPDATE THIS PATH: The absolute path to your project's public directory
    root * /var/www/html/public
    
    php_fastcgi 127.0.0.1:9000
    file_server
}

# Match all domains on port 443 (HTTPS)
:443 {
    tls {
        on_demand
    }

    # UPDATE THIS PATH: The absolute path to your project's public directory
    root * /var/www/html/public

    # Use PHP-FPM
    php_fastcgi 127.0.0.1:9000
    
    # Serve static files
    file_server

    # Optional: Log configuration
    log {
        output file /var/log/caddy/access.log
    }
}

# Match all domains on port 80 (HTTP)
:80 {
    # UPDATE THIS PATH: The absolute path to your project's public directory
    root * /var/www/html/public
    
    php_fastcgi 127.0.0.1:9000
    file_server
}
